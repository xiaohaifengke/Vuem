{"version":3,"file":"vuem.js","sources":["../src/observer/array.js","../src/utils.js","../src/observer/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["/**\r\n * Created by Liu on 2020/6/10.\r\n */\r\nconst arrayPrototype = Array.prototype\r\n\r\nconst arrayMethods = Object.create(arrayPrototype)\r\nconst methods = [\r\n    'push',\r\n    'pop',\r\n    'shift',\r\n    'unshift',\r\n    'reverse',\r\n    'sort',\r\n    'splice'\r\n]\r\n\r\nmethods.forEach(method => {\r\n    arrayMethods[method] = function (...args) {\r\n        const result = arrayPrototype[method].apply(this, args)\r\n        const ob = this.__ob__\r\n        let inserted\r\n        switch (method) {\r\n            case 'push':\r\n            case 'unshift':\r\n                inserted = args\r\n                break\r\n            case 'splice':\r\n                inserted = args.slice(2)\r\n                break\r\n        }\r\n        inserted && ob.observeArray(inserted)\r\n        return result\r\n    }\r\n})\r\n\r\nexport { arrayMethods }","/**\r\n * Created by Liu on 2020/6/11.\r\n */\r\nexport function isObject (value) {\r\n    return value !== null && typeof value === 'object'\r\n}","/**\r\n * Created by Liu on 2020/6/10.\r\n */\r\n\r\nimport { arrayMethods } from './array'\r\nimport { isObject } from '../utils'\r\n\r\nclass Observer {\r\n    constructor (data) {\r\n        Object.defineProperty(data, '__ob__', {\r\n            enumerable: false,\r\n            configurable: false,\r\n            value: this\r\n        })\r\n        if (Array.isArray(data)) {\r\n            data.__proto__ = arrayMethods\r\n            this.observeArray(data)\r\n        } else {\r\n            this.walk(data)\r\n        }\r\n    }\r\n\r\n    observeArray (arr) {\r\n        for (let i = 0; i < arr.length; i++) {\r\n            observe(arr[i])\r\n        }\r\n    }\r\n\r\n    walk (val) {\r\n        const keys = Object.keys(val)\r\n        for (let i = 0; i < keys.length; i++) {\r\n            let key = keys[i]\r\n            defineReactive(val, key, val[key])\r\n        }\r\n    }\r\n}\r\n\r\nfunction defineReactive (data, key, value) {\r\n    observe(value) // 如果传入的值还是一个对象的话 就做递归循环检测\r\n    Object.defineProperty(data, key, {\r\n        get () {\r\n            return value\r\n        },\r\n        set (val) {\r\n            if (val === value) return\r\n            observe(val)\r\n            value = val // 监控当前设置的值，有可能用户给了一个新值\r\n        }\r\n    })\r\n}\r\n\r\nexport function observe (data) {\r\n    if (!isObject(data)) return // 只监控对象\r\n\r\n    if (data.__ob__ instanceof Observer) return // 防止重复观测\r\n\r\n    // 对数据进行defineProperty\r\n    return new Observer(data)\r\n}\r\n\r\n","/**\r\n * Created by Liu on 2020/6/10.\r\n */\r\n\r\n\r\nimport { observe } from './observer/index.js'\r\n\r\nexport function initState (vm) {\r\n    const options = vm.$options\r\n    options.props && initProps(vm)\r\n    options.methods && initMethod(vm)\r\n    options.data && initData(vm)\r\n}\r\n\r\nfunction initProps (vm) {\r\n\r\n}\r\nfunction initMethod (vm) {\r\n\r\n}\r\nfunction initData (vm) {\r\n    // 响应式原理从此处开始\r\n    let data = vm.$options.data // 用户传入的数据\r\n    data = vm._data = typeof data === 'function'? data.call(vm): data // vm._data 是数据观测后存储的真实位置。 在使用vm[key]取值时，最终会到vm._data里面取值\r\n    // 数据观测\r\n    observe(data)\r\n}","/**\r\n * Created by Liu on 2020/6/11.\r\n */\r\n\r\nexport function compileToFunctions (template) {\r\n    let ast = parseHTML(template)\r\n\r\n    // 模板编译原理\r\n\r\n    // 1.先把template转化成ast语法树 （1）  parser 解析  (正则)\r\n    // 2.标记静态树  （2） 树得遍历标记 markup\r\n    // 3.通过ast产生的语法树 生成 代码 =》 render函数  codegen\r\n}","/**\r\n * Created by Liu on 2020/6/10.\r\n */\r\nimport {initState} from './state'\r\nimport {compileToFunctions} from './compiler/index.js'\r\n\r\nexport function initMixin (Vuem) {\r\n    Vuem.prototype._init = function (options) {\r\n        const vm = this\r\n        vm.$options = options // 暂不处理参数\r\n        initState(vm) // 初始化状态\r\n        // 模板渲染\r\n        if (vm.$options.el) { // 判断用户是否传入了el属性\r\n            vm.$mount(vm.$options.el)\r\n        }\r\n    }\r\n\r\n    Vuem.prototype.$mount = function (el) {\r\n        const vm = this\r\n        const options = vm.$options\r\n        el = document.querySelector(el)\r\n\r\n        if (!options.render) {\r\n            let template = options.template\r\n            if (!template && el) {\r\n                template = el.outerHTML\r\n            }\r\n            const render = compileToFunctions(template)\r\n            options.render = render\r\n        }\r\n    }\r\n}\r\n\r\n","/**\r\n * Created by Liu on 2020/6/10.\r\n */\r\nimport {initMixin} from './init'\r\nfunction Vuem (options) {\r\n    if (!(this instanceof Vuem)) {\r\n        console.warn('Vue is a constructor and should be called with the `new` keyword')\r\n    }\r\n    this._init(options) // 初始化操作\r\n}\r\n\r\ninitMixin(Vuem) // 各种初始化 配置、生命周期、data等\r\nexport default Vuem"],"names":["arrayPrototype","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","result","apply","ob","__ob__","inserted","slice","observeArray","isObject","value","Observer","data","defineProperty","enumerable","configurable","isArray","__proto__","walk","arr","i","length","observe","val","keys","key","defineReactive","get","set","initState","vm","options","$options","props","initProps","initMethod","initData","_data","call","compileToFunctions","template","ast","parseHTML","initMixin","Vuem","_init","el","$mount","document","querySelector","render","outerHTML","console","warn"],"mappings":"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"}